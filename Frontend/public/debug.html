<!-- Android Debug Page - Add to Frontend -->
<!DOCTYPE html>
<html>
<head>
    <title>Android Debug</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .box { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #5B2EFF; }
        .success { border-left-color: green; }
        .error { border-left-color: red; }
        .warning { border-left-color: orange; }
        code { background: #eee; padding: 2px 5px; border-radius: 3px; }
        button { padding: 10px 15px; background: #5B2EFF; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 5px 0 0; }
        button:hover { background: #7C5CFF; }
        #output { white-space: pre-wrap; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üîç Android Debug Console</h1>
    
    <div class="box warning">
        <strong>‚ö†Ô∏è What to Test:</strong><br>
        1. Click "Test Localhost Backend" (should work)<br>
        2. Click "Test 10.0.2.2 Backend" (Android emulator only)<br>
        3. Check your User Agent and API URL<br>
        4. Test Register/Login endpoints manually
    </div>

    <div class="box">
        <h3>üì± Environment Info</h3>
        <button onclick="showEnv()">Show Environment</button>
        <div id="env" style="margin-top: 10px;"></div>
    </div>

    <div class="box">
        <h3>üåê Backend Tests</h3>
        <button onclick="testBackend('localhost')">Test Localhost:3000</button>
        <button onclick="testBackend('10.0.2.2')">Test 10.0.2.2:3000</button>
        <button onclick="testBackend('192.168.0.102')">Test 192.168.0.102:3000</button>
        <div id="output" style="margin-top: 10px; background: #fafafa; padding: 10px; border-radius: 5px;"></div>
    </div>

    <div class="box">
        <h3>üìã Test Register/Login</h3>
        <button onclick="testRegisterLogin()">Test Register + Login Flow</button>
        <div id="authOutput" style="margin-top: 10px; background: #fafafa; padding: 10px; border-radius: 5px;"></div>
    </div>

    <script>
        function log(msg) {
            document.getElementById('output').innerHTML += msg + '\n';
        }

        function logAuth(msg) {
            document.getElementById('authOutput').innerHTML += msg + '\n';
        }

        function showEnv() {
            let ua = navigator.userAgent;
            let env = `User Agent: ${ua}\n`;
            env += `Is Android: ${ua.includes('Android')}\n`;
            env += `Is Mobile: ${ua.includes('Mobile')}\n`;
            env += `Hostname: ${window.location.hostname}\n`;
            env += `Protocol: ${window.location.protocol}\n`;
            
            // Detect API URL like api.js does
            let apiUrl = 'localhost:3000';
            if (ua.includes('Android') || window.cordova) {
                apiUrl = '10.0.2.2:3000';
            } else if (ua.includes('Mobile')) {
                apiUrl = '192.168.0.102:3000';
            } else if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                apiUrl = 'localhost:3000';
            }
            
            env += `\nüéØ Detected API URL: http://${apiUrl}`;
            
            document.getElementById('env').innerHTML = `<pre>${env}</pre>`;
        }

        async function testBackend(host) {
            log(`\nüìç Testing http://${host}:3000/api ...`);
            try {
                const response = await fetch(`http://${host}:3000/api`);
                const data = await response.json();
                log(`‚úÖ SUCCESS: ${JSON.stringify(data)}`);
            } catch (err) {
                log(`‚ùå FAILED: ${err.message}`);
            }
        }

        async function testRegisterLogin() {
            logAuth('\nüîÑ Starting Register + Login Test...\n');
            
            const email = `test${Date.now()}@mail.com`;
            const password = 'Pass123';
            
            // Try all possible URLs
            const urls = ['localhost:3000', '10.0.2.2:3000', '192.168.0.102:3000'];
            
            for (let baseUrl of urls) {
                logAuth(`\n--- Testing with ${baseUrl} ---\n`);
                
                try {
                    // Register
                    logAuth(`üìù Registering ${email}...`);
                    const regResp = await fetch(`http://${baseUrl}/users/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: 'Test User',
                            email: email,
                            password: password,
                            contact: '+91 9999999999'
                        })
                    });
                    
                    const regData = await regResp.json();
                    if (regData.success) {
                        logAuth(`‚úÖ Register Success\n`);
                        
                        // Login
                        logAuth(`üîë Logging in...`);
                        const loginResp = await fetch(`http://${baseUrl}/users/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email, password })
                        });
                        
                        const loginData = await loginResp.json();
                        if (loginData.success) {
                            logAuth(`‚úÖ Login Success! Token: ${loginData.token.substring(0, 20)}...`);
                            logAuth(`\n‚úÖ ${baseUrl} works! Use this in your app.`);
                            break;
                        } else {
                            logAuth(`‚ùå Login failed: ${loginData.message}`);
                        }
                    } else {
                        logAuth(`‚ùå Register failed: ${regData.message}`);
                    }
                } catch (err) {
                    logAuth(`‚ùå Error with ${baseUrl}: ${err.message}`);
                }
            }
        }

        // Show env on load
        showEnv();
    </script>
</body>
</html>
